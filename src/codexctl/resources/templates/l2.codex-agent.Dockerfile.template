# syntax=docker/dockerfile:1
ARG BASE_IMAGE
FROM ${BASE_IMAGE}

ENV DEBIAN_FRONTEND=noninteractive

USER root
RUN set -eux; \
    apt-get update; \
    apt-get install -y --no-install-recommends curl ca-certificates gnupg; \
    curl -fsSL https://deb.nodesource.com/setup_22.x | bash -; \
    apt-get install -y --no-install-recommends nodejs ripgrep; \
    npm install -g @openai/codex; \
    npm install -g @anthropic-ai/claude-code; \
    npm cache clean --force; \
    rm -rf /var/lib/apt/lists/*

RUN set -eux; \
    printf '%s\n' \
      'alias codex="codex --dangerously-bypass-approvals-and-sandbox"' \
      'alias claude="claude --dangerously-skip-permissions"' \
      > /etc/profile.d/codexctl-agent-aliases.sh; \
    if [ -f /etc/bash.bashrc ]; then \
      printf '\n# codexctl agent aliases\n. /etc/profile.d/codexctl-agent-aliases.sh\n' >> /etc/bash.bashrc; \
    else \
      printf '# codexctl agent aliases\n. /etc/profile.d/codexctl-agent-aliases.sh\n' > /etc/bash.bashrc; \
    fi

USER dev
# No CMD: reuse init-ssh-and-repo.sh from base image
